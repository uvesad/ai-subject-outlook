<!DOCTYPE html>
<html>
<head>
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
</head>
<body>
  <script>
    Office.onReady(() => { /* Office.js llest */ });

    async function generateSubject(event) {
      // 1. Cos del missatge (text pla)
      Office.context.mailbox.item.body.getAsync("text", async res => {
        const body = res.value || "";
        // 2. Crida a OpenAI
        const r = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer sk-XXXX"    // <-- posa-hi la teva API key
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [{ role: "user", content: "Escriu un assumpte breu i professional per aquest correu:\n" + body }],
            max_tokens: 20,
            temperature: 0.7
          })
        });
        const data = await r.json();
        const subject = data.choices[0].message.content.trim();
        // 3. Escriure l'assumpte
        Office.context.mailbox.item.subject.setAsync(subject, () => event.completed());
      });
    }
  </script>
</body>
</html>
